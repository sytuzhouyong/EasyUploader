+ (void)queryResourcesWithPrefix:(NSString *)prefix limit:(int)limit offset:(int)offset {
    NSString *requestPath = [NSString stringWithFormat:@"/list?limit=10&bucket=%@", kBucket];
    NSString *requestPathAuthed = [self.class signURL:requestPath andBody:@""];
    NSString *url = [NSString stringWithFormat:@"%@%@", kQiniuResourceHost, requestPath];

    NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:[NSURL URLWithString:url]];
    [request setValue:requestPathAuthed forHTTPHeaderField:@"Authorization"];
    [request setValue:@"application/x-www-form-urlencoded" forHTTPHeaderField:@"Content-Type"];
    [request setValue:@"rsf.qbox.me" forHTTPHeaderField:@"Host"];
    NSLog(@"headers = %@", kHttpManager.requestSerializer.HTTPRequestHeaders);

    [[[AFHTTPSessionManager manager] dataTaskWithRequest:request completionHandler:^(NSURLResponse * _Nonnull response, id  _Nullable responseObject, NSError * _Nullable error) {
        NSLog(@"response = %@", responseObject);
        NSLog(@"error = %@", error);
    }] resume];
}

+ (void)queryBucketsWithBlock:(BucketsBlock)block {
    NSString *requestPath =  @"/buckets";
    NSString *requestPathAuthed = [self.class signURL:queryURL andBody:@""];
    NSString *url = [NSString stringWithFormat:@"%@%@", kQiniuResourceHost, requestPath];

    NSMutableURLRequest *request = [[NSMutableURLRequest alloc] initWithURL:[NSURL URLWithString:url]];
    [request setValue:requestPathAuthed forHTTPHeaderField:@"Authorization"];
    [request setValue:@"application/x-www-form-urlencoded" forHTTPHeaderField:@"Content-Type"];
    [request setValue:@"rsf.qbox.me" forHTTPHeaderField:@"Host"];
    NSLog(@"headers = %@", kHttpManager.requestSerializer.HTTPRequestHeaders);

    [[[AFHTTPSessionManager manager] dataTaskWithRequest:request completionHandler:^(NSURLResponse * _Nonnull response, id  _Nullable responseObject, NSError * _Nullable error) {
        NSLog(@"response = %@", responseObject);
        NSLog(@"error = %@", error);
    }] resume];
}



+ (void)addBucketWithName:(NSString *)name {
    NSString *requestPath =  @"/buckets";
    NSString *requestPathAuthed = [self.class signURL:queryURL andBody:@""];
    NSString *url = [NSString stringWithFormat:@"%@%@", kQiniuResourceHost, requestPath];
    ;
}

#pragma mark - 生成指定url和body的管理凭证
+ (NSString *)signURL:(NSString *)url andBody:(NSString *)body {
    const char *sign = [[NSString stringWithFormat:@"%@\n%@", url, body] cStringUsingEncoding:NSUTF8StringEncoding];
    const char *secretKey = [kSecretKey UTF8String];

    char digestStr[CC_SHA1_DIGEST_LENGTH];
    bzero(digestStr, 0);
    CCHmac(kCCHmacAlgSHA1, secretKey, strlen(secretKey), sign, strlen(sign), digestStr);

    NSString *encodedDigest = [GTMBase64 stringByWebSafeEncodingBytes:digestStr length:CC_SHA1_DIGEST_LENGTH padded:TRUE];
    NSString *auth = [NSString stringWithFormat:@"%@:%@", kAccessKey, encodedDigest];
    auth = [NSString stringWithFormat:@"QBox %@", auth];
    NSLog(@"auth = %@", auth);
    return auth;
}
